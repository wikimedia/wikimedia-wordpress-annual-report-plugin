(()=>{"use strict";const e=window.wp.blocks,t=window.wp.i18n,o=window.wp.blockEditor,l=window.wp.editPost,i=window.wp.element,r=window.wp.data,s=window.ReactJSXRuntime,n=()=>{},c=({color:e=null,label:t="",onColorChange:l=n,clientId:i})=>{const r=(0,o.__experimentalUseMultipleOriginColorsAndGradients)(),c=[{colorValue:e,onColorChange:l,label:t}];return(0,s.jsx)(o.InspectorControls,{group:"color",children:(0,s.jsx)(o.__experimentalColorGradientSettingsDropdown,{settings:c,panelId:i,hasColorsOrGradients:!1,__experimentalIsRenderedInSidebar:!0,...r})})},a=(0,t.__)("(Waypoint group has no ToC label)","wmf-reports"),h=e=>{const t=[];return e.forEach((e=>{e.attributes.includeInToC&&t.push(e),e.innerBlocks&&h(e.innerBlocks).forEach((e=>{t.push(e)}))})),t},p=(0,o.withColors)({highlightColor:"highlight-color"})((function({attributes:e,highlightColor:n,setHighlightColor:p,setAttributes:d,clientId:g}){const u=(0,r.useSelect)((e=>e(o.store).getBlocks())),{selectBlock:w}=(0,r.useDispatch)(o.store),{openGeneralSidebar:b}=(0,r.useDispatch)(l.store),m=(0,i.useMemo)((()=>h(u).map((e=>({clientId:e.clientId,tocLabel:e.attributes.tocLabel,tocSlug:e.attributes.tocSlug,selectBlock(){w(e.clientId),b("edit-post/block")}})))),[u,w,b]);(0,i.useEffect)((()=>{d({waypoints:JSON.stringify(m.map((({tocLabel:e,tocSlug:t})=>({tocLabel:e,tocSlug:t}))))})}),[m,d]);return e.highlightColor&&e.highlightColor,(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c,{label:(0,t.__)("Highlight","wmf-reports"),color:n?.color||e.highlightColor,onColorChange:p,clientId:g}),(0,s.jsx)("ul",{...(0,o.useBlockProps)({style:{...e.highlightColor?{"--wmf-toc-highlight-color":`var(--wp--preset--color--${e.highlightColor})`}:{}}}),children:m.map((e=>(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:`#${e.tocSlug}`,onClick:()=>{w(e.clientId),b("edit-post/block")},children:e.tocLabel||a})},`waypoint-${e.clientId}`)))})]})})),d=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"wmf-reports/table-of-contents","version":"0.1.0","title":"Report Table of Contents","textdomain":"wmf-reports","category":"widgets","icon":"editor-ul","description":"Render a table of contents based on labeled group blocks.","example":{},"supports":{"multiple":false,"html":false},"attributes":{"highlightColor":{"type":"string"},"waypoints":{"type":"string","default":""}},"editorScript":"file:./index.js","style":"file:./index.css","viewScript":"file:./view.js"}');(0,e.registerBlockType)(d.name,{...d,edit:p,save:function({attributes:e}){return(0,s.jsx)("ul",{...o.useBlockProps.save(),children:JSON.parse(e.waypoints||"[]").map((e=>(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:`#${e.tocSlug}`,children:e.tocLabel})},`waypoint-${e.tocSlug}`)))})}})})();
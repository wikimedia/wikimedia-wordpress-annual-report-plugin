(()=>{"use strict";const e=window.wp.blocks,t=window.wp.i18n,o=window.wp.blockEditor,i=window.wp.editPost,l=window.wp.element,s=window.wp.data,r=window.ReactJSXRuntime,n=(0,t.__)("(Waypoint group has no ToC label)","wmf-reports"),c=e=>{const t=[];return e.forEach((e=>{e.attributes.includeInToC&&t.push(e),e.innerBlocks&&c(e.innerBlocks).forEach((e=>{t.push(e)}))})),t},a=(0,o.withColors)({highlightColor:"highlight-color"})((function({attributes:e,highlightColor:a,setHighlightColor:h,setAttributes:p,clientId:d}){const g=(0,s.useSelect)((e=>e(o.store).getBlocks())),{selectBlock:u}=(0,s.useDispatch)(o.store),{openGeneralSidebar:w}=(0,s.useDispatch)(i.store),b=(0,l.useMemo)((()=>c(g).map((e=>({clientId:e.clientId,tocLabel:e.attributes.tocLabel,tocSlug:e.attributes.tocSlug,selectBlock(){u(e.clientId),w("edit-post/block")}})))),[g,u,w]);(0,l.useEffect)((()=>{p({waypoints:JSON.stringify(b.map((({tocLabel:e,tocSlug:t})=>({tocLabel:e,tocSlug:t}))))})}),[b,p]);const m=(0,o.__experimentalUseMultipleOriginColorsAndGradients)();return e.highlightColor&&e.highlightColor,(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.InspectorControls,{group:"color",children:(0,r.jsx)(o.__experimentalColorGradientSettingsDropdown,{settings:[{label:(0,t.__)("Highlight","wmf-reports"),colorValue:a?.color||e.highlightColor,onColorChange:e=>{h(e)}}],panelId:d,hasColorsOrGradients:!1,__experimentalIsRenderedInSidebar:!0,...m})}),(0,r.jsx)("ul",{...(0,o.useBlockProps)({style:{...e.highlightColor?{"--wmf-toc-highlight-color":`var(--wp--preset--color--${e.highlightColor})`}:{}}}),children:b.map((e=>(0,r.jsx)("li",{children:(0,r.jsx)("a",{href:`#${e.tocSlug}`,onClick:()=>{u(e.clientId),w("edit-post/block")},children:e.tocLabel||n})},`waypoint-${e.clientId}`)))})]})})),h=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"wmf-reports/table-of-contents","version":"0.1.0","title":"Report Table of Contents","textdomain":"wmf-reports","category":"widgets","icon":"editor-ul","description":"Render a table of contents based on labeled group blocks.","example":{},"supports":{"multiple":false,"html":false},"attributes":{"highlightColor":{"type":"string"},"waypoints":{"type":"string","default":""}},"editorScript":"file:./index.js","style":"file:./index.css","viewScript":"file:./view.js"}');(0,e.registerBlockType)(h.name,{...h,edit:a,save:function({attributes:e}){return(0,r.jsx)("ul",{...o.useBlockProps.save(),children:JSON.parse(e.waypoints||"[]").map((e=>(0,r.jsx)("li",{children:(0,r.jsx)("a",{href:`#${e.tocSlug}`,children:e.tocLabel})},`waypoint-${e.tocSlug}`)))})}})})();